# 2020/11/02 17:38:39  zt
# Pytecplot script to extract pressure probes

# We don't load case and data in this script AND just 
# process data in the current Tecplot frame

import sys,os
import tecplot as tp

# Run script with "-c" option to connect with Tecplot
if '-c' in sys.argv:
    tp.session.connect()

def probeData(points):
    # Take probes for a given list of points
    result = []
    for p in points:
        temp = tp.data.query.probe_at_position(p[0],p[1],p[2])
        if temp is None:
            print("Point:",p," is outside the domain!")
            sys.exit()
        else:
            data,cell,zone = temp
            result.append(data)
    return result

def list2str(l):
    s = ''
    for temp in l:
        s += str(temp)+',' 
    s = s[:-1]
    s += '\n'
    return s

# Point list
# 1
p1 = [
        [0.070657572219096, 0.019999999999996, 0.17058247357581],
        [0.070657573632699, 0.040000000144703, 0.170582473153316],
        [0.070657575645824, 0.06000000035078, 0.170582472551639],
        [0.070657572015199, 0.079999999979124, 0.17058247363675],
        [0.070657572245758, 0.100000000002725, 0.170582473567841],
        [0.070657579414057, 0.120000000736523, 0.170582471425401],
        [0.070657572805047, 0.140000000059978, 0.170582473400683],
        [0.070657574798214, 0.160000000264013, 0.17058247280497],
        [0.070657575679509, 0.180000000354228, 0.170582472541572]
        ]
# 2
p2 =  [
        [0.060142348143467, 0.020038000669602, 0.145196474808711],
        [0.061707839229445, 0.039779980315334, 0.148975903244334],
        [0.063412314392063, 0.059884229276636, 0.153090869091781],
        [0.064518439801191, 0.08010260016658, 0.155761300490873],
        [0.065485867797377, 0.100078985007699, 0.158096868156696],
        [0.06590126711309, 0.120290247504274, 0.159099749256058],
        [0.066683948588011, 0.140024172331806, 0.16098928337847],
        [0.067329307891377, 0.160117521499051, 0.162547339518311],
        [0.06788230137277, 0.180089641420976, 0.163882376663201],
        [0.067882298754241, 0.199999999731948, 0.163882377445819],
        [0.067882298754241, 0.199999999731948, 0.163882377445819],
        [0.067882302285911, 0.240000000093475, 0.163882376390284],
        [0.067882295436998, 0.259999999392372, 0.163882378437267],
        [0.067882299524791, 0.279999999810827, 0.16388237721552],
        [0.067882301594435, 0.300000000022691, 0.16388237659695]
        ]
# 3
p3 = [
        [0.049332093124541, 0.02000000004231, 0.119098209829502],
        [0.049332092659471, 0.039999999994702, 0.119098209968501],
        [0.049332094430186, 0.060000000175965, 0.119098209439275],
        [0.049332096439938, 0.080000000381698, 0.119098208838606],
        [0.049332093173704, 0.100000000047342, 0.119098209814809],
        [0.049332093685364, 0.12000000009972, 0.119098209661885],
        [0.049332096976759, 0.14000000043665, 0.119098208678163],
        [0.049332090658522, 0.159999999789871, 0.119098210566539],
        [0.049332093727913, 0.180000000104075, 0.119098209649168],
        [0.049332092150557, 0.199999999942606, 0.119098210120604],
        [0.049332094850824, 0.220000000219024, 0.119098209313556],
        [0.049332092706349, 0.239999999999501, 0.11909820995449],
        [0.049332094305793, 0.260000000163231, 0.119098209476453],
        [0.04933209304855, 0.280000000034531, 0.119098209852214],
        [0.049332092557973, 0.299999999984312, 0.119098209998836]        
        ]
# 4
p4 = [
        [0.040743551762271, 0.020031061877835, 0.098363631860952],
        [0.039408321080579, 0.039972783754727, 0.095140102431701],
        [0.037992066074164, 0.060019818197338, 0.091720954554579],
        [0.036087912364944, 0.079955685271441, 0.087123928961388],
        [0.034103969818135, 0.100527608054814, 0.082334266295111],
        [0.031711184448408, 0.120033862727464, 0.076557571669963],
        [0.025134001473421, 0.140027787447992, 0.060678846475728],
        [0.02355593510128, 0.160391594646155, 0.056869060910921],
        [0.023519862479391, 0.179815955586812, 0.056781970491359],
        [0.01962596956149, 0.200368223524563, 0.047381283343072],
        [0.014917357592307, 0.220062938931304, 0.036013687150494]
        ]

datas = []

# Get variable names
frame = tp.active_frame()
dataset = frame.dataset
varNames = dataset.variable_names

for probes in [p1,p2,p3,p4]:
    result = probeData(probes)
    datas.append(result)

for i in range(4):
    f = open('probes'+str(i)+'.csv','w')
    f.writelines(list2str(varNames))
    for temp in datas[i]:
        f.writelines(list2str(temp))
    f.close()

